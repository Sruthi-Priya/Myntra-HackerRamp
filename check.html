<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dress Designer</title>
  <link rel="stylesheet" href="check1.css">
 
  <script src="js2.js"></script>
  <script src="js1.js"></script>
</head>

<body>
  <div class="root">
    <div id="navbar_container">
      <div id="navbar">
        <a href="index.html">
          <div id="logo">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256"
              height="256" viewBox="0 0 256 256" xml:space="preserve">
              <desc>Created with Fabric.js 1.7.22</desc>
              <defs>
              </defs>
              <g transform="translate(128 128) scale(0.72 0.72)">
                <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;"
                  transform="translate(-175.05 -175.05000000000004) scale(3.89 3.89)">
                  <path
                    d="M 35.813 54.013 H 4.514 C 2.025 54.013 0 51.987 0 49.498 V 4.514 C 0 2.025 2.025 0 4.514 0 h 31.299 c 2.489 0 4.514 2.025 4.514 4.514 v 44.984 C 40.328 51.987 38.303 54.013 35.813 54.013 z"
                    style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,80,192); fill-rule: nonzero; opacity: 1;"
                    transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                  <path
                    d="M 35.813 90 H 4.514 C 2.025 90 0 87.975 0 85.485 V 69.741 c 0 -2.489 2.025 -4.515 4.514 -4.515 h 31.299 c 2.489 0 4.514 2.025 4.514 4.515 v 15.744 C 40.328 87.975 38.303 90 35.813 90 z"
                    style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,109,255); fill-rule: nonzero; opacity: 1;"
                    transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                  <path
                    d="M 85.485 90 H 54.187 c -2.489 0 -4.515 -2.025 -4.515 -4.515 V 40.501 c 0 -2.489 2.025 -4.514 4.515 -4.514 h 31.299 c 2.489 0 4.515 2.025 4.515 4.514 v 44.984 C 90 87.975 87.975 90 85.485 90 z"
                    style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,80,192); fill-rule: nonzero; opacity: 1;"
                    transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                  <path
                    d="M 85.485 24.773 H 54.187 c -2.489 0 -4.515 -2.025 -4.515 -4.515 V 4.514 C 49.672 2.025 51.697 0 54.187 0 h 31.299 C 87.975 0 90 2.025 90 4.514 v 15.745 C 90 22.748 87.975 24.773 85.485 24.773 z"
                    style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,109,255); fill-rule: nonzero; opacity: 1;"
                    transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                </g>
              </g>
            </svg>
          </div>
        </a>
        <div id="login_container">
          <a id="login" href="login.html">Login</a>
        </div>
      </div>
    </div>

    <div class="menubar_body">
      <nav id="menubar">
        <a href="#first">Material</a>
        <a href="#second">Pattern</a>
        <a href="#third">Color</a>
        <a href="#fourth">Border</a>
      </nav>
    </div>

    <div class='container'>
      <section id='first'>
        <div class="card_container">
          <ul class="cards">
          </ul>
        </div>
      </section>

      <section id='second'>
        <div class="card_container">
          <ul class="cards">
          </ul>
        </div>
      </section>

      <section id='third'>
        <div class="colorjoe_wrapper">
          <div class="colorjoe_container">
            <div class="colorjoe"></div>
            <div class="config">
              <p class="title">Selected Color</p>
              <div class="colorName">#ffffff</div>
              <div class="color"></div>
            </div>
          </div>
        </div>
      </section>

      <section id='fourth'>
        <div class="card_container">
          <ul class="cards">
          </ul>
        </div>
        <button onclick="send_selected()" id="submit">Submit</button>
      </section>
    </div>
  </div>

  <script>
    let user = null;
    console.log("User:",sessionStorage.getItem("user"))
    if (sessionStorage.getItem("user")) {
      user = sessionStorage.getItem("user");
      document.getElementById("login").innerText = user;
    }
    if (document.cookie == null) {
      document.getElementById("login").innerText = "Login";
    }

    class ColorPicker {
      constructor(root) {
        this.root = root;
        this.colorjoe = colorjoe.rgb(this.root.querySelector(".colorjoe"))
        this.selectedColor = null;

        this.colorjoe.show();
        this.setSelectedColor["#ffffff"];

        this.colorjoe.on("change", color => {
          this.setSelectedColor(color.hex());
        })
      }

      setSelectedColor(color, skipCjUpdate = false) {
        this.selectedColor = color;
        this.root.querySelector(".colorName").textContent = color;
        this.root.querySelector(".color").style.background = color;
      }

    }

    const cp = new ColorPicker(document.querySelector(".colorjoe_container"));

    var selected = [];

    function toggle_selection(id, page) {
      let current_a = document.getElementById(id).firstElementChild
      if (selected[page] && selected[page] != id) {
        let selected_a = document.getElementById(selected[page]).firstElementChild
        selected_a.classList.remove("selected");
        current_a.classList.add("selected");
        selected[page] = id;
      }
      else if (selected[page] && selected[page] == id){
        current_a.classList.toggle("selected");
        selected[page] = null;
      }
      else {
        current_a.classList.toggle("selected");
        selected[page] = id;
      }
    }

    let send_selected = async () => {
      if (user != null && user != "") {
        selected[2] = document.querySelector(".colorName").textContent
        console.log(selected)
        let reply = await fetch('http://localhost:3000/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({selected, user}),
        })

        let message = await reply.json()
        if(message.message == true){
          window.alert("Order Placed. Manufacturer will contact you for further communications!")
        }
        else{
          window.alert("Error Occured!")
        }
      }
      else {
        window.alert("Please Login!")
      }
    }
  </script>
</body>

</html>